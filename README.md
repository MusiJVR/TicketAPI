# TicketAPI

**TicketAPI** - это REST API для управления тикетами (заявками), предназначенное для создания, просмотра, обновления и завершения тикетов. API позволяет автоматизировать процесс обработки заявок, обеспечивая удобный интерфейс для их управления.

Основные возможности **TicketAPI**:

- Создание тикетов с заголовком и описанием проблемы.
- Просмотр всех тикетов или фильтрация по датам.
- Получение детальной информации о конкретном тикете.
- Взятие тикета в работу, его отмена или завершение.
- Массовая отмена всех тикетов, находящихся в работе.

---

## Технологии

- [Node.js](https://nodejs.org/en/) - среда выполнения **JavaScript**
- [Express](https://expressjs.com/) - фреймворк для создания веб-приложений и API
- [SQLite](https://www.sqlite.org/) - легковесная реляционная база данных
- [Sequelize](https://sequelize.org/) - ORM для работы с базой данных

---

## Настройка и запуск

API требует **SQLite** базы данных. Можно создать файл `.env` в корневом каталоге и указать в нём настройки для подключения к БД и порт сервера. Если переменные окружения не заданы, будут использоваться значения по умолчанию:

```bash
DB_NAME=database.sqlite
PORT=3000
```

### Установка зависимостей

Для работы API необходимо установить [**Node.js**](https://nodejs.org/en/). Затем выполните установку зависимостей:

```bash
npm install
```

### Запуск сервера

Запустить сервер можно следующей командой:

```bash
npm run start
```

---

## Использование API

Ниже приведены примеры запросов к API.

### Создание нового тикета

#### Запрос

`POST /tickets`

```json
{
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере"
}
```

#### Ответ

```json
{
    "id": 2,
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере",
    "status": "Новое",
    "solutionText": null,
    "cancelReason": null,
    "createdAt": "2025-02-23T06:03:41.137Z",
    "updatedAt": "2025-02-23T06:03:41.137Z"
}
```

### Получение всех тикетов

#### Запрос

`GET /tickets`

Дополнительно можно использовать параметры фильтрации по дате (формат `YYYY-MM-DD`):
- `/tickets?date=YYYY-MM-DD` - фильтрация по конкретной дате
- `/tickets?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD` - фильтрация по диапазону дат (важно, чтобы начальная дата была раньше конечной)

#### Ответ

```json
[
    {
        "id": 1,
        "title": "Проблема с телефоном",
        "description": "Поставил на ночь телефон на зарядку и утром он перестал включаться",
        "status": "В работе",
        "solutionText": null,
        "cancelReason": null,
        "createdAt": "2025-02-21T07:34:07.427Z",
        "updatedAt": "2025-02-22T08:39:30.042Z"
    },
    {
        "id": 2,
        "title": "Проблема с Интернетом",
        "description": "Последнее время стал часто пропадать Интернет на компьютере",
        "status": "Новое",
        "solutionText": null,
        "cancelReason": null,
        "createdAt": "2025-02-23T06:03:41.137Z",
        "updatedAt": "2025-02-23T06:03:41.137Z"
    }
]
```

### Получение тикета по ID

#### Запрос

`GET /tickets/:id`

#### Ответ

```json
{
    "id": 2,
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере",
    "status": "Новое",
    "solutionText": null,
    "cancelReason": null,
    "createdAt": "2025-02-23T06:03:41.137Z",
    "updatedAt": "2025-02-23T06:03:41.137Z"
}
```

### Взять тикет в работу

#### Запрос

`PATCH /tickets/:id/take`

#### Ответ

```json
{
    "id": 2,
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере",
    "status": "В работе",
    "solutionText": null,
    "cancelReason": null,
    "createdAt": "2025-02-23T06:03:41.137Z",
    "updatedAt": "2025-02-23T06:14:14.347Z"
}
```

### Отмена тикет

#### Запрос

`PATCH /tickets/:id/cancel`

```json
{
    "cancelReason": "Мы не можем решить вашу проблему, обратитесь к провайдеру"
}
```

#### Ответ

```json
{
    "id": 2,
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере",
    "status": "Отменено",
    "solutionText": null,
    "cancelReason": "Мы не можем решить вашу проблему, обратитесь к провайдеру",
    "createdAt": "2025-02-23T06:03:41.137Z",
    "updatedAt": "2025-02-23T06:19:29.958Z"
}
```

### Отмена всех тикетов в работе

#### Запрос

`PATCH /tickets/cancel-all-in-work`

```json
{
    "cancelReason": "Техническая отмена тикетов"
}
```

#### Ответ

```json
{
    "message": "Tickets cancelled",
    "count": 1
}
```

### Завершение тикета

#### Запрос

`PATCH /tickets/:id/complete`

```json
{
    "solutionText": "Мы отправили к вам мастера, ожидайте звонка"
}
```

#### Ответ

```json
{
    "id": 2,
    "title": "Проблема с Интернетом",
    "description": "Последнее время стал часто пропадать Интернет на компьютере",
    "status": "Завершено",
    "solutionText": "Мы отправили к вам мастера, ожидайте звонка",
    "cancelReason": null,
    "createdAt": "2025-02-23T06:03:41.137Z",
    "updatedAt": "2025-02-23T06:24:06.923Z"
}
```

---

## Лицензия

**TicketAPI** распространяется по лицензии [**MIT**](https://opensource.org/license/mit/).
